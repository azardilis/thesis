Formal models of physical systems serve two roles (i) documentation and
communication of our understanding and (ii) formal analysis (simulation). The
most common language for describing the natural world is dynamical systems
theory. It has a long tradition in Physics starting from Newton and Poincare. It
relies on a conceptual abstraction where instead of describing the objects that
form the physical world, it describes quantifiable properties of such
objects. For example, when explaining the movement of planets one does not talk
about the moon but rather about the position of the moon. Then the evolution of
the system in time (or space) is described by (partial) differential (or
difference) equations that state the change in the numerical values of the
quantifiable properties that form the system as they interact with each
other. For example, one might write the equation of position of a particle or a
molecule diffusing in a medium. This abstraction of avoiding dealing with the
objects directly but rather with some numerical variables representing their
properties has been at the core of the success of dynamical systems theory. A
big ensemble of methods have been developed for the analysis of such systems,
which one gets for free if they choose to describe a physical system of interest
in these terms.

Dynamical systems languages have not been as successful in scenarios where the
structure of the described system is not static. While one might be able to find
a quantifiable property of the system to describe, in cases where the question
posed is about the changing structure itself or about how it gives rise to other
dynamics, such an abstraction is not adequate. Consider for example plant
development and its effect on carbon intake for the entire plant. While in some
cases writing an equation for the size of the plant is enough, a truly
mechanistic understanding requires treating the developing structure that gives
rise to plant size explicitly. How would one write equations for the size of the
leaves, for example, if new ones keep appearing?  In those cases one might be
better off with a language that allows the description of the objects
themselves, their interactions, and organisation. Unsurprisingly such languages
have been developed for scientific fields that deal with parts of the natural
world where structures are dynamic and self-organising. A whole strand of work
on languages of increasing complexity exist for the description of biochemical
systems starting from simple molecular reactions. The field of plant development
also has seen an independent strand of work on languages with explicit
description of objects.  Both these strands of work have seen a heavy
interaction and inspiration from Computer Science where there exist many
formalisms in the theory of computation for the description of object behaviour
and interaction.
% especially in concurrent computation but also in sequential

%we need names for the two kinds of languages -- make the distinction so we can
%refer to them later
Here we are interested in understanding a plant or particular aspects of a plant
at the organism level starting from genomes and molecular mechanisms. In order
to understand the links between all relevant processes we need models with
explicit representation of processes at multiple levels. Apart from the
scientific challenges that this presents there are also technical and social
challenges, among which is the choice of representation (language) for
describing our models. Since we are trying to recreate an organism in silico and
especially one where development is plastic and happens throughout its life
history, we need to be able to describe dynamics of discrete objects. At the
same time we also have the need for abstraction through quantifiable properties
since the complexity of the task is large. 

There are languages in both the dynamics and structure space that combine
aspects of both worlds. The language we describe and that is a big part of this
thesis is situated in this space too. It comes from the biochemistry tradition
and has discrete objects at its core but at the same time also has attributes to
abstract away some internal structure of these objects. It further has features
for (i) linking the abstract (attributes) and the concrete (observables) and
(ii) explicitly using time, which is inspired, again, by the dynamics world.

Since language design is as much art as it is science it can sometimes be hard
to properly situate a new language (Chromar) in the space of already existing
languages for the description of the natural world especially if one is only
familiar with one part of the world, perhaps the particular formalisms that are
standard for their disciplines. We therefore feel the need to include an
overview of existing languages (the ones we hinted to above) for Biology in
order to be able to place our work in the language design space. Since we have
particular requirements for structure representation, we will only deal with
languages coming from the discrete world or from the dynamics world that include
some support for defining discrete organisation as well.

Concretely, in this chapter we will do the following:
\begin{itemize}

\item Introduction of two modelling examples that have representation
  requirements that are typical of the multi-scale comprehensive models that we
  are interested in in this thesis.
\item An overview and comparison of languages coming from (i) the discrete world
  with an emphasis on languages from the biochemistry strand of work since
  Chromar is a direct product of these and (ii) the dynamics world that have
  some aspect of structural organisation. In order to place these languages and
  later be able to compare them we will place them all in a feature space. The
  features are related to their characteristics in regards to capturing complex
  organisation, dynamics, but also meta-features like readability. The above
  examples will serve to illustrate the features and limitations of each
  formalism.
\end{itemize}
While there are attempts for formal comparisons between languages
\citep{felleisen1991expressive}, here the design space is so large that such an
attempt is probably impossible. We instead will do our comparison informally
through the illustrative examples. We finally conclude with a summary of the
comparison. In the next chapter we introduce Chromar through the same examples
so we can properly place it and its novel characteristics in the same feature
space.

A more comprehensive overview of the above dichotomy between dynamics and
structure appears in \citet{fontana1996barrier}.

\section{Examples}
\label{sec:examples}
In this section we will introduce two examples that we will use throughout our
language space overview to illustrate their limitations and the motivation
for their extensions with new features. We will not attempt a full
representation of the models in each formalism

\subsection{Root apical meristem and whole-plant effects}
\label{subsec:rootDev}
Plant development happens at sites of meristematic activity. In the root this
site is at root cap and it is called Root Apical Meristem (RAM). In root
development this raises the question about the mechanism through which this gives
rise to the root architecture but also how the meristematic cells maintain their
position close to the root cap throughout development. The hormone auxin and its
distribution of concentration along the root architecture has been pinpointed as
a possible mechanism to explain both of these phenomena.

Here we will consider auxin dynamics in a growing 1-D array of root cells
proposed by \citep{mironova_plausible_2010} as a possible mechanism to explain
the observed distribution of auxin concentration throughout the root. We will
further consider the effect of the resulting root architecture on above-ground
plant growth through its effect on water intake. We will only consider a very
abstract version of the shoot. This model is indicative of the kind of
comprehensive models that are the focus of this thesis. Here, for example, a
more detailed root model is placed in the context of the whole plant (more
abstract model) and the surrounding environment.

\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{figures/rootDev.eps}
\caption{Flows of auxin through the root.}
\label{fig:rootDev}
\end{figure}

More precisely we will consider the following dynamics
(Figure~\ref{fig:rootDev}):
\begin{itemize}
\item Auxin flow from the shoot. Since we're only considering an abstract shoot
  we can think of auxin flow from the shoot as auxin being produced in the first
  cell of the root.
\item Auxin degradation through cell expansion.
\item Auxin diffusion as passive transport between cells driven by concentration
  differences across the array.
\item Auxin active transport by the PIN transporter proteins.
\item Cell division.
\item Shoot growth, which depends on the water uptake through the root. The
  uptake depends on the length of the root.
\end{itemize}


\subsection{Plant development in a field}
\label{subsec:plantDev}
The example considers a very abstract view of plant development, but has
nevertheless enough details to demonstrate the main features of our
notation. Our model is inspired by the Framework Model (FM) of
\citet{chew_multiscale_2014}, a modular whole-plant model that connects
traditional plant biology representations of molecular processes with
representations of organ and whole-plant development processes. We will put this
model in a more ecologically relevant context (field).

The above-ground part of an Arabidopsis plant
architecture before flowering: a collection of leaves arranged in a circle. Each
leaf photosynthesises, creating the main currency, carbon; uses some carbon for
maintenance and some for growth; and transfers any remaining carbon to the other
leaves. The FM represents the Arabidopsis rosette (collection of leaves) with no
preference in the transfer, thus we have an all-to-all communication. Similarly
to the FM, in our model all the molecular processes in our model reside in a
central plant `cell' which allows us to keep the leaves as carbon sinks and
track their growth, while avoiding the per-leaf molecular processes and their
communication (see Figure~\ref{fig:fm}).

\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{figures/fms.eps}
\caption{ A Our simple plant development model. All the interactions, that in
  this case are transfer of carbon, happen between the central Cell that
  represents the molecular state of the entire plant and the leaves, which act
  as carbon sinks. The carbon that goes to the leaves is either used for growth,
  in which case it is transformed into new material (increase of mass), or to
  maintain the already existing Leaf by fuelling its life sustaining
  processes. New leaves are also created, forming new sinks and increasing
  competition for carbon between the leaves, but also increasing the production
  of carbon by providing new green areas for photosynthesis. B The simple plant
  model embedded in a 2-D field.}
\label{fig:fm}
\end{figure}

The processes that affect growth are as follows: we think of \textit{carbon
assimilation} per leaf as increasing the carbon concentration of the central
Cell depending on the photosynthesis level of a leaf (which will depend on its
size); we think of \textit{maintenance respiration} as the central Cell giving
some carbon to a leaf; and we think of \textit{growth respiration} as the
central Cell giving some carbon to a leaf and the leaf mass increasing. We will
also have \textit{new leaf creation}. There are interesting dynamics here such
as the interaction between growth and assimilation: the more we grow, the more
the leaves can photosynthesise, and the more carbon can go to the central Cell.

We assume that the plants are arranged in a two-dimensional field and that they
compete for light, which affects their growth. While we use Arabidopsis here,
such models are interesting for the interactions and competition between crops
and weeds in the field \citep{rajcan_understanding_2001}.


\section{Object-based languages}
\label{sec:objectLangs}
A significant line of work in languages from the discrete (object-based)
tradition has stemmed from the world of Biochemistry. A further distinction in
this camp is between \emph{rule-based} languages and \emph{process-calculi
  based} languages that differ in what they consider as their main unit of
description -- rule-based languages consider the event described as a rule
whereas process-based languages consider the individual object/process as the
main unit of description. Here we will focus more on languages from the
rule-based camp since Chromar follows that tradition. Our focus, however, is not
any specific language but rather the features of the languages and the modelling
requirements that motivated them. Both camps have undergone similar extensions
(starting from simple objects) of features driven by the same modelling
requirements so while we focus more on rule-based languages, our observations
should apply to the other camp as well, which we will only mention in passing in
the following text.

% cite Mjolness paper
In the following sections we categorise object-based languages based on their
features starting from simple objects to structure to dynamics. We will give an
overview and focus on languages that combine objects with dynamics since Chromar
is situated in this space too. Throughout this text we will use the above
examples to illustrate the features and limitations of the languages.

\subsection{Unstructured: Petri Nets}
\label{subsec:pns}
%description
The simplest language for unstructured collections of simple objects is that of
Petri Nets (PNs). At the description level PNs represent discrete objects with
types (species) where the dynamics are given as reactions that state how
different species interact to change the number of objects of the corresponding
species in the state of the system. The state of the system is an unstructured
collection (multiset) of copies (molecules) of each species. Qualitatively,
applying a reaction to a state (multiset) means removing from the state the
elements that appear in the lhs of the reaction and adding the elements that
appear on ths rhs of the reaction.

There is an equivalent graphical representation where the system is given as a
bipartite graph representing species as places (round nodes) and reactions as
transitions (rectangular nodes). Each place has an associated marking,
represented as tokens inside the node, that represents the multiplicity of that
species in the state. Applying a transition amounts to moving tokens between
places.

\begin{center}
    \includegraphics{figures/pns.eps}
\end{center}

A \emph{multiset} $m$ over a set $A$ is a function from $A$ to $\mathbb{N}$ counting
the multiplicity of each element $a \in A$ in the multiset. There is submultiset
relation on multisets where for two multisets $m$ and $m'$, $m \preceq m'$ if for each
element $a \in A$ $m(a) \leq m'(a)$. We write $M[A]$ for the set of all multisets
over a set $A$. Given a set of species $\Sigma$, a \emph{reaction} is a structure $\rho
= l \xrightarrow{k} r$ where $k \in R$ and both the left-hand and right-hand
sides are multisets over the species. 

\begin{definition}
A \emph{Petri Net} is a pair $(\Sigma, R)$ of sets of species $\Sigma$ and reactions $R$.
\end{definition}

The state of the Petri Net is a multiset over $\Sigma$. A reaction in $\rho \in R$ can be
applied to a state $s$ if $l(\rho) \preceq s$ giving a new state $s' = s -
l(\rho) + r(\rho)$, which we write as $\rho \bullet s$.

%semantics
Petri Nets can be given a stochastic interpretation as Continuous Time Markov
Chains (CTMCs). A CTMC is a triple $(S, Q, I)$ with a $S$ a set of states,
$Q: S \times S \rightarrow \mathbb{R}$ that gives the transition rate between
any two states, and $I$ the initial state. For each reaction apart from the base
rate given by $k$ we need to know how many times it can be applied in a give
state $s$ (\ie how many times its left-hand side appears in the state). This is
also called a \emph{match}. The multiplicity of a multiset $m$ in another
multiset $m'$ (number of matches) is given by:
$$
\mu(m, m') = \prod_{a \in m}  \binom{m'(a)}{m(a)}
$$
Given a PN $(\Sigma, R)$ and an initial state we can get a CTMC:
\begin{align*}
  S & = M[\Sigma] \\
  Q(s, s') &= \sum {k(\rho) \cdot \mu(l(\rho), s) | \rho \in R, r \bullet s = s'}
\end{align*}
% Have to say how that defines a master equation for the probabilities of the states
% doing anything with that is impossible but
% Gillespie to get trajectories?
%practically this means calculating the above.

%examples
PNs have been used widely for describing chemical reactions and other simple
systems. For systems like the ones in our examples they pose some limitations
though. Suppose for example that we wanted to write reactions for the diffusion
of auxin along the root (see first example: \ref{sec: rootDev}). We could write
the following reactions for the auxin molecules in each cell, where
$\mathrm{A}_1$ is an auxin molecule in the first cell, $\mathrm{A}_2$ is an
auxin molecule in the second cell, with the diffusion occurring at rate
$d$, and so on:
\begin{align*}
\mathrm{A}_1 &\xrightarrow{d} \mathrm{A}_2 \\
\mathrm{A}_2 &\xrightarrow{d} \mathrm{A}_1 \\
\mathrm{A}_2 &\xrightarrow{d} \mathrm{A}_3\\
 &  \hspace{6pt}  \vdots& \\
\varnothing & \xrightarrow{\alpha} \mathrm{A}_1 \\
 & \hspace{6pt}  \vdots &\\
\mathrm{A}_1 &\xrightarrow{\beta} \varnothing \\
  & \hspace{6pt}  \vdots 
\end{align*}
There are two problems with the above description. The first is that it is not
very compact. It grows with the number of cells since we have to write the
diffusion reaction for every pair of cells in both directions and
production/destruction reactions for every cell. The second is that it is
impossible to describe the creation of new cells because we need to create a new
auxin species for the new cell and new reactions, but the notation provides no
way to express such a possibility. We could try to make a cell species but then
we would have no way of linking the cell objects with the auxin objects and we
would have the same problems as above. We also have no way of representing
quantifiable properties of these objects, like the size of the cell, for
example, needed for an abstract description of growth. Furthermore properties of
bigger parts of the state, like the size of the entire root, needed for the
water-dependent shoot growth cannot be expressed and neither can parts of the
surrounding environment that we do not wish to model in detail like the water in
the soil.

\subsection{Structured}
\label{subsec:structLangs}
Extensions to simple reactions add support for adding organisation to the
unstructured multisets of objects in PNs. Organisation can be thought of as
explicitly adding relations over the collections of objects. There are many
relations that could be represented and the ones in this thread are,
unsurprisingly, inspired by cell biochemistry.

\subsubsection*{Hierarchy}
The first organisational principle is that of nesting inspired by the
compartment organisation inside a cell. Following this cell organisation,
languages usually distinguish two kinds of objects -- simple ones that cannot be
nested and more complex ones that can. P-systems is a language for membrane
computing and while it initially considered only simple objects enclosed in a
static (potentially multilevel) membrane structure \citep{puaun2000computing},
in later extensions membranes become first class and are equipped with dynamics
\citep{puaun2001p}. SMMR~\citep{oury_multi-level_2013} also makes this
distinction between simple objects (species) and complex objects that can be
nested (agents). The Calculus of Wrapped Compartments \citep{coppo_stochastic}
also considers nesting but it also adds notational features for expressing
computations that happen on the membrane. A later extension
\citep{coppo_hybrid_2010} adds names to compartments and they can then be
thought of as the agents of SMMR or the membranes of P-systems. The allowed
dynamics of these systems reflect the interpretation of the hierarchical
relation over collections objects as compartmental organisation inside
cells. Therefore sometimes the permitted operations are directly inspired by
this view while in other cases they seem more generic. In all cases, however,
the additional structure allows to express more stringent conditions on the
left-hand side of rules that select based on structure and type (as possible in
PNs).
\begin{center}
    \includegraphics{figures/nest.eps}
  \end{center}  
The nesting relation can also take other interpretations, for example as a
`part-of' relation. At a static level this might be reasonable but some of the
allowed dynamics might not be sensible any more as they only make sense for a
particular cell-inspired interpretation of the relation (see discussion in
\citet{artale_part-whole_1996}).

Semantics are given, like PNs, with similar interpretations as
CTMCs. As states become more complex, however, practically drawing trajectories
from the stochastic process becomes harder as finding the number of matches from
the lhs of a rule to the state is more complex than simple multiplication of the
multiset multiplicities of the lhs elements.

Going to our examples, it looks possible to represent parts of the root
development + auxin dynamics. For example, we could have a $\mathrm{Cell_i}$
species per cell to represent root cells and $\mathrm{A}$ species to represent auxin
molecules. Using nested parentheses to represent the nesting relation we could
write the diffusion to the right reaction for the first position of the 1-d
array as:
$$
\mathrm{Cell_1}(A, x), \mathrm{Cell_2}(y) \rightarrow \mathrm{Cell_1}(x), \mathrm{Cell_2}(y, A)
$$
This description has the same problems as the simple PN description in that it is
not compact and the creation of new cells requires the creation of new
species. If we interpret the nesting relation as the 'next-to' relation we
can use a single $\mathrm{Cell}$ species and creation of new cells would not
require creating new species:
\begin{align*}
  \text{State (4 cells): } & \mathrm{Cell(Cell(Cell(Cell)))} \\
  \text{Division: } & \mathrm{Cell}(x) \rightarrow \mathrm{Cell}(\mathrm{Cell}(x))
\end{align*}
Then, however, we would not be able to use the given nesting relation for the
actual containment of the auxin molecules. The problem here is that there are
two relations, the 'next-to' relation over cells that we need since the
communication is only defined for neighbouring cells and a nesting relation
between cells and auxin molecules.

The same problems discussed above regarding abstraction of object attributes via
quantifiable properties (\eg cell size), abstractions over parts of the whole
state (\eg size of entire root), and representation of the surrounding
environment also appear here.

\subsubsection*{Links}
Another organisational principle sometimes considered explicitly is that of
complexation inspired by protein complexes. Kappa \citep{danos_formal_2004}
considers the state of the system as a graph, for example:
\begin{center}
    \includegraphics{figures/kappaG.eps}
  \end{center}
% semantics  
Reaction (or rules) have the usual qualitative interpretation: anything that
'matches` the lhs in the state can be replaced by the rhs. Kappa
also has a stochastic interpretation as a CTMC where the states are
site-graphs. Practically, again, the problem is finding and counting the matches
of lhs's of rules into the state, which is even harder in the case of
graphs. There are, however, certain properties of Kappa graphs that
allow for a more efficient simulation that does not require recomputing the
matches after every rule application \citep{danos_scalable_2007}.
  
% examples
Using this site-graph approach we can represent the 1-D arrangement of cells from
our example:
\begin{center}
    \includegraphics{figures/kappaCell.eps}
\end{center}
We, again, have the same problem we noted above regarding properties that cannot
easily be represented by discrete objects, like cell properties, observables
over states, and time. We note though that the simulator of Kappa, KaSim
\citep{KaSimManual2014}, has facilities for observation of states, which can
be used inside rules.

Other formalisms allow for more than one relation, for example bigraphs
\citep{milner1999communicating} and the more biologically relevant stochastic
bigraphs, which have a stochastic interpretation as CTMCs
\citep{krivine_stochastic_2008}. Using this we could represent both the
neighbour relation between cells and the nesting of auxin molecules inside
cells. The rest of the limitations we noted persist, however, since it is an
object-only language.

\subsection{Combining structure and dynamics}
\label{subsec:structDynLangs}
Going beyond the object world, other extensions to these rule-based languages
try to combine traditional features of object-based formalisms with dynamical
features to represent more abstract quantifiable properties of the objects.
It is interesting to note that adding attributes allows one to implicitly represent
relations based on attribute selections on the left-hand side of rules.

\subsubsection*{Coloured Petri Nets}
% description
As the name implies Coloured Petri Nets are an extension to Petri Nets (Section)
that allows distinctions between objects of each species (colouring of objects)
by allowing them to have an associated data value adhering to the type (colour
set) of their species~\citep{jensen_coloured_1987}. For example, for our root
development system instead of having a simple $\mathrm{Cell}$ species we can
have a $\mathrm{Cell}$ species with associated parameters (\eg position in the
array). Qualitatively CPNs work in the same way as simple PNs. Applying a
reaction moves tokens between places. Since we have more complex type of objects
the transitions have inscriptions to bind object colour values to variables
names so that they can be used in the lhs (out-arrows) of the transition. Note
that the same dynamical description is used for the dynamics of objects and
their attributes. In the case of object-based dynamics (adding, removing
objects) conceptually things are the same as before. For changing attributes we
simply remove an object and replace with its attribute changed.

%semantics
A stochastic version of this CPN formulation has also been used for biological
modelling before, for example for describing planar cell polarity in Drosophila
wings~\citep{gao_multiscale_2013} (and see~\citet{runge_application_2004,
gilbert_colouring_2013} for other examples). In these examples where the
stochastic version was used, its semantics are just given as a translation to
the corresponding simple Petri Net. CPNs are used in their graphical format and
most tools therefore use a graphical interface.

Going to our root development example we can use colours to represent the
`next-to' relation between cells, as well as the concentration of auxin and
other abstract quantifiable properties like cell size. To represent\emph{diffusion} we
employ the $\mr{Cell}$ colourset $\{\mr{id}: \mr{int}, \mr{l}:\mr{int},
\mr{a}:\mr{int} \} $. Apart from the number of auxin molecules, $a$, we also have
positional information. In order to determine the position of a cell in the
array we use its identifier colour $\mr{id}$ and the identifiers of its left
neighbour, $\mr{l}$ colour, and right neighbour $\mr{r}$ colour.
\begin{center}
    \includegraphics{figures/cpnDiff.eps}
\end{center}
This is an example of an implicit representation of a relation between objects
where the relation information is stored in the objects themselves. This is in
contrast to the explicit representation of relations that we have seen in the
languages with representation of structure (hierarchy and links, see
previous sections). While it is more flexible it places more burden on the user
to maintain this relation.

To represent \emph{growth} we add another colour,
$\mr{s}:\rm{real}$ to our $\mr{Cell}$ colourset and another colourset for the
entire root ($\mr{Root}$) so that we can store its size ($\rm{s}$)
\begin{center}
    \includegraphics{figures/cpnGrowth.eps}
\end{center}
Growth also degrades auxin concentration in the cell. Here we have used an
additional colourset to represent global information as the language does not
offer the possibility of explicitly defining the functional correspondence
between the size colours of the $\mr{Cell}$ tokens and the size of the entire
root. This means that the user has to manually keep track of this function and
update the global information.

For both of the transitions we consider we used some colours with $\mr{real}$
types. Since the semantics of CPNs are given via unfolding to their simple PNs,
the problem here is that in many cases the unfolded simple Petri Net has an
infinite number of reactions. This means that in order to do the unfolding at
all, the types have to be finite sets, which further means that real values are
not allowed. This is also reflected in the implementation of Coloured Petri Net
tools where one can define a Stochastic Coloured Petri Net but the definition is
unfolded before it is run~\citep{heiner_snoopyunifying_2012}.Petri Net tools
further have a graphical interface for defining the models, although there is a
hybrid approach that allows mixing the graphical definition with programming
language constructs (ML language)~\cite{jensen_coloured_1987}. While graphical
notations are intuitive for smaller models, we find that for larger models
they become hard to read.

Finally, following the root development example there is no way to easily
represent the water availability in the surrounding soil.

\subsubsection*{Coloured Stochastic Multilevel Multiset Rewriting (CSMMR)}
CSMMR~\citep{oury_coloured_2011} is an extension to
SMMR~\citep{oury_multi-level_2013} that adds parameters to agents, motivated by
the limitations we have noted in the object-only languages that we have
considered (subsections~\ssec{structLangs} and~\ssec{pns}). Parameters can take
part in rules either passively by influencing rates rules, conditions and so on
but can also be actively changed. The addition of parameters gives it a very
similar flavour to CPNs. However, a CSMMR model, unlike a CPN model, is given
stochastic interpretation directly as a CTMC.

Using a CSMMR agent type similar to the CPN $\mr{Cell}$ colourset for the root
development example (\ssec{rootDev}), we can write the following
for the diffusion (to the right) of auxin along the root:
$$
\mr{Cell}_{\mr{id}=i, \mr{a}=a}, \mr{Cell}_{r=k, a=a'} \xrightarrow{}
\mr{Cell}_{\mr{id}=i, \mr{a}=a+D(a'-a)}, \mr{Cell}_{r=k, a=a+D(a-a')} \, \,
[i=k]
$$
This is very similar to the CPN transition of the same dynamics but written in a
completely textual form.

Similar limitations to the CPNs (discussed above) regarding time dependent
values (\eg for representing water in the soil) and observational abstraction
over parts of the state (\eg size of the entire root) also appear here. The
availability of richer types for parameters would also work well with a more
expressive expression language perhaps utilising a general-purpose programming
language, like CPN tools do with ML.

\subsubsection*{Dynamical Grammars}
Dynamical Grammars of \citet{mjolsness2006stochastic} have a truly hybrid
approach where the quantifiable properties of objects can be defined by
differential equations as in dynamical systems theory.
$$
\{\tau_i[x_{i, 1}, \dots, x_{i, k[\tau_i]}] \} \rightarrow \{\tau_i[x_{i, 1}, \dots, x_i, k[\tau_i]]\} \, \,
\text{ solving } \{\frac{dx_{i,j}}{dt}=f_{i, j}(t)\}
$$
Everything else looks similar to other languages in this section, dynamics are
given as rules where each side of the rule is a multiset of discrete objects
with typed sequence of attributes. The interesting part comes from the
$\mr{solving}$ clause that can be used to express the dynamics of the attributes
as differential equations.

Going to our root development example, the diffusion can be expressed in a way
that is more familiar to the traditional diffusion models,
\begin{align*}
\{c_i=\mr{Cell}(i, a_i), c_{i+1}=\mr{Cell}(r, a_{i+1})\} \rightarrow \{c_i,
  c_{i+1}\} \\
  \text{ solving }\{\frac{da_i}{dt}=D(a_{i+1}-a_i),
  \frac{da_{i+1}}{dt}=D(a_i - a_{i+1} \}
\end{align*}
where we use the same $\mr{Cell}$ agent type as before.

Having the differential equations means we can also express time-dependent
values, for example to represent the change of moisture in the soil surrounding
the root in an abstract (non-mechanistic) way.
\begin{align*}
\{\mr{Shoot(s)}, \mr{Env}(w), \mr{Root(s)} \rightarrow \{\mr{Shoot(g(s))}, \mr{Env}(w),
  \mr{Root(s)} \} \\
  \text{ solving }\{\frac{dw}{dt}=f(w, t) \}
\end{align*}
However, if we are, as it is usually the case, taking the water values from a
table then it might be hard to find a mathematical description that fits the
differential equation framework. Moreover mixing these two paradigms
(object-based and differential equations for the dynamics) might in some cases
put an extra mental burden on the user, especially if they are not familiar with
dynamical systems theory. Rules on discrete objects, operating on the objects or
their properties, correspond nicely to biological events and intuitive
descriptions of biological processes.

We note that there is no possibility for expressing observational abstractions
over parts of the state and a similar scheme to the one we used in the CPN
formulation, with an extra $\mr{Root}$ type object will have to be used.


\subsection{Plant development: L-systems}
\label{subsec:lSystems}
Another line of work started in the plant development tradition.
They followed roughly the same evolution of starting with simple objects and
then adding parameters for combining quantifiable properties with
objects. Traditional object-only L-systems are a string-rewriting formalism
where strings of characters (representing the objects) can be rewritten via
rules that specify how characters can be replaced by other character (or
sequences of characters). The lhs of the rules can be context-sensitive by
specifying the characters surrounding the character intended for replacement:
$$
a< b > c \rightarrow a < d > c
$$
For example, the above specifies that an object $b$ can be replaced by an object
$d$ in the string state of the system in places where it is surrounded by $a$ on
the left and $c$ on the right. Unlike the object languages we have seen before
that rely on multisets, L-systems rely on strings, which are ordered. Adding
parameters work in the same way as the transition from PNs to CPN, for example,
and it was motivated by the same modelling requirements.

%semantics
Unlike the PN family from the Biochemistry tradition, L-systems are not usually
interpreted as CTMCs. They instead rely on discrete time and multiple parallel
application of rules in cases where more than one is applicable.

% examples - limitations
The ordered parametric L-systems seem to work well for our root development
example since the cells along the root are ordered in an ordered sequence. The
'next-to' relation then need no further machinery (implicit representation) to
be represented. The diffusion rule will look like this, again using a
$\mr{Cell}$ object with similar parameters as before:
$$
\mr{Cell}(a_i)< \mr{Cell}(a_{i+1}) > \rightarrow \mr{Cell}(a_i+D(a_{i+1}-a_i)< \mr{Cell}(a_{i+1}+D(a_i-a_{i+1}) >
$$

L-systems might be not be as good in cases where the structure of the system is
not linear or cannot (easily) be linearised as a string. Take, for example, the
dynamics from our plant development example (Section~\ssec{plantDev}). The
leaves in that case and the 'cell` are not linearly related. It would therefore
be hard to write, for example, the rule for leaf growth that requires
information from both the leaves and cell objects.

Similar limitations regarding observational abstraction of parts of the state,
time-dependent value representation also appear here.

\section{Dynamics to structure}
\label{sec:dyns}
In the previous section we focused on languages that are object-based and
followed their evolution through adding features like adding extra structure on
the objects and then adding features that are more traditionally from the
dynamics world. Here, instead, we focus on languages that have dynamics at their
heart but have some features for representing (dynamic) structure as well.

\todo{at least mention others like Hydra, Modelica, etc.}

\subsection{Simile}
\label{subsec:simile}
%description
Simile is another graphical language that has similarities to our approach
\citep{muetzelfeldt_simile_2003}. Simile is used mainly in the domains of
ecology and agricultural sciences but has also been used in systems biology (for
the whole-plant model \citep{chew_multiscale_2014} that was the inspiration for
our example in Section~\ssec{plantDev}) to exactly solve the kind of limitations
we noted in the object-only based languages. External inputs are also supported,
which is particularly important for adding weather data to crop models. In
Simile there are two levels of definition of a model. At the first level we have
continuous variables with rate equations and at the second level we have
discrete objects with discrete dynamics -- adding/removing. The objects are
grouped based on their types, and their behaviour is given at the population
level. The dynamics of the two types of entities, continuous variables and objects, are
not integrated as is the case in CPNs and CSMMR.

%semantics?
There is an obvious interpretation of the first-level continuous variables as a
systems of differential equations but there is no obvious interpretation as a
formal mathematical object for the entirety of the Simile features including the
object-level dynamics. At the implementation level a model generates a system of
Ordinary Differential Equations (ODEs) and then keeps track of the objects. Any
time there is a structural change to the model, the system of ODEs is
recalculated and integrated numerically until the next point of structural
change (\eg new object in population).

%limitations through examples
In order to illustrate how Simile features capture the modelling requirements from our
examples, let us start with the plant development example (Section~\ssec{plantDev}),
\begin{center}
  \includegraphics[scale=0.6]{figures/simileGrowth.eps}
\end{center}
We have a population of Leaf objects and a single Cell object representing
what we called $\mathrm{Cell}$ in our rules. Each Leaf in the population has a
mass that grows as a continuous variable. In order to define the use of carbon
for growth from the carbon variable in the Cell object we have to work at the
population level by summing the contribution of each Leaf. The population of
Leaf objects also grows (see creation box). The description is at the level of
objects instead of at the level of events, like in rule-based languages, which
means that the dynamics are distributed across the model. Having the dynamics at
the rules sometimes seems more natural as they correspond more naturally to the
conceptual view of systems.

Object relations can also be encoded through conditions to restrict the dynamics
to a subset of the object types, similarly to conditional expressions available
in CPNs and CSMMR. For example, the diffusion dynamics that happen only between
neighbouring cells can be encoded.
\begin{center}
  \includegraphics[scale=0.6]{figures/simileRoot.eps}
\end{center}
Here the diffusion dynamics are restricted to neighbouring cells through the
association submodel, assoc, and a relevant condition (see `next-to' box).

Representing cell division is more challenging as the dynamics of objects can
only be represented at the population level. In the case of cell division the object
`creation' is not identical for all cells since the position matters for keeping
the next-to relation information (identifiers) updated.

%general meta-level limitations
Finally, like CPNs, the graphical notation of Simile becomes, in our experience,
problematic for models with more than a few variables, thereby requiring further
visualisation tools. While CPNs have graphical elements for species and
transitions, Simile represents all variables and interactions graphically
further adding to the complexity of the representation.

\section{Pragmatic approaches}
When modellers are confronted with complexity in models like the ones we have
seen in the Introduction or the example ones from this chapter, they sometimes
turn to more pragmatic approaches when they cannot map their understanding into
any suitable technical language.

Most of the pragmatic approaches are based on using an ad-hoc representation of
the model as a program in a general-purpose programming language. We next give
an overview of these methods with references to the examples as before.


\subsection{Models as programs}
By far the most popular approach when confronted with the limitations of either
object-based or dynamics-based languages we noted above, is to use a custom
simulation software. In this approach the domain knowledge is represented as a
program and it is mixed with the simulation code, especially if one is writing a
one-off program. The programs are not usually mapped or interpreted as
mathematical objects. Models like the Framework Model \citep{chew2014multiscale}
and the whole-cell of \citet{karr_whole-cell_2012}, which are examples of the
kinds of the comprehensive multi-scale models we are interested in, are written
in this way, for example (both given as Matlab programs).

Turning to our examples, in order to write the root development model one could
write something like the following in a general-purpose programming language:

\begin{BVerbatim}
type Mode = Idle | Growing
type Cell = {s, a: real, m: Mode}
type Shoot = {s : real}
type State = {root : [Cell], shoot : Shoot}

function simulate(s : State, n:Int) -> [State]
  ...
  for i = 1 to n
    s' = step s
    ...

function step(s: State) -> State
  s' = (diff . growth . cellDiv . ...) s
  return s'
\end{BVerbatim}

where we assume we are in a programming language that allows the definition of
compound data types that we use to represent the information about cells and the
shoot. We first decide on a representation for the state of the system where we
use a list to represent the array of cells in the root since lists are
ordered. Then in order to simulate the system we apply the \texttt{step}
function \texttt{n} times to some initial state. The \texttt{step} function
applies functions that represent all the biological processes that change the
systems of the system, diffusion, cell growth and division and so on.

One is faced not only with a decision on representation but also with a decision
of a simulation algorithm to follow, since the model is not mapped to a
well-defined technical language with existing implementation. Since
general-purpose programming languages are inherently sequential, for example,
one has to find a reasonable serialisation of the execution of the processes
that does not affect the results. \citet{karr_whole-cell_2012} deal with this by
using an appropriate time-step and in each time-step randomising the execution
of the processes.
%mention somewhere declaratively vs describing the process

This approach gives greater flexibility as one can use any existing programming
language constructs, either built-in or through external libraries, for the
construction of the model. At the same time, unless one spends a great deal of
effort, the resulting representation is hard to read in the first place and hard
to maintain or extend in the future. In contrast, the rule-based representations
we have seen above are inherently declarative and concurrent and extending a
model is just a matter of concatenating more rules to the existing ones.

\subsubsection{Multi-model simulation environments}
To deal with the problem of extension many models are written in a modular way
such that related components are packaged together. Each component is written in
the most convenient way. The problem comes in their combination.Sometimes models
are written in different programming languages, with different input/output
formats, different time-steps, units and other incompatabilities. What happens
in practice is that models are usually reimplemented in one language to create a
multi-model written in a single language. This is the approach taken, for
example, in the Framework Model where all constituent models are reimplemented
in Matlab along with other compatability changes, likes time resolution changes.

There has been some work on multi-model simulators that can deal with
heterogeneous models written in possibly different languages or have other
incompatibilities. The idea is that the user declares their intentions on how
the modules should interact and the rest, like interaction, conversion and
simulation, are handled by the framework. The modular integration of processes
in the \citet{karr_whole-cell_2012} model inspired the \emph{mois} tool
\citep{erbm_mois_2015} that uses various techniques, like variable time-steps
and backtracking \citep{bucher2013decomposition}, for the simulation of the
interacting modules. Another tool \citep{cis_2018} was developed as part of the
Plants in Silico initiative \citep{zhu_plants_2016}, a collaborative effort on
multi-scale plant and crop modelling.

\subsection{Simulation frameworks}
Going a step further, instead of the user having to write custom simulation
software, some frameworks provide libraries that expose common functionality for
the construction or combination of models.

\subsubsection*{Agent-based frameworks}
In Agent-based modelling (ABM) simulation frameworks, the description of the
process/model happens declaratively through the description of the behaviour of
classes of agents (see for example \cite{solovyev2010spark} used in systems
biology).

While initially this looks similar to the object-based formalisms we have seen
above, in ABM systems the main unit of description is the entire behaviour of
each individual agent, whereas in rule-based formalisms it is the rule, which
can both describe a (possibly partial) behaviour of an individual agent and a
synchronised action of two or more agents. This ability to specify
synchronisation often leads to more natural descriptions and, more practically,
makes the resulting models easier to change and combine. The advantages of being
in a programming language remain.

\subsection{Crop Simulation frameworks}
Modelling has historically been used much more extensively in crop science than
in plant biology. Several large models incorporating significant environemental
components (from soil to ecosystem) have been developed. These have been
increasingly developed in a modular fashion providing the user with
functionality for common modelling scenarios, like calculation of water uptake
or light interception by the canopy \citep{keating_overview_2003}. In order to
increase re-usability and decrease user effort, several frameworks have been
developed on top of crop simulaiton software that offer a set of parameterised
components that can be used to model different scenarios or even different crops
\citep{brown_plant_2014}.

This modular approach of crop models has found its way in complex and
comprehensive biology models, like the \citet{karr_whole-cell_2012} whole-cell
model and the Framework Model \citep{chew2014multiscale}, which were built in a
modular fashion with exactly the same motivation -- re-usability and
extensibility. Writing these models requires familiarity the programming
language of the framework but, again, the advantages of a general-purpose
programming language remain.


\subsection{Model interchange formats (SBML)}
% SBML
The growth of the systems biology movement led to a large number of tools for
the representation and analysis of models of molecular processes. Most of the
models can be represented by all dealt with similar type of processes of genetic
networks and were represented similarly as systems of ODE's in the continuous
form or Petri Nets in a discrete form. The Systems Biology Markup Language
\citep[SMBL;][]{hucka_systems_2003} was developed as an interchange format
between the different tools for these kind of processes and had support for the
representation of the most commonly used constructs in these models, reactions,
compartments along with model information, like units and so on.

As models started becoming more complex it faced the same limitations we noted
in the Introduction and in the Petri Net section regading dynamic organisation
among others. This led to the development of multiple extensions to the original
format \citep[SBML L3];[]{sbmlL3} to handle the increased complexity. For
example, the `Dynamic Structures' package adds support for defining dynamic
structures and the `Hierarchical Model Composition' package adds support for
hierarchy representation. The L3 specification was put to the test for the
representation of the \citet{karr_whole-cell_2012} whole-cell model
\citep{waltemath_toward_2016}.

SBML models are only used as a description language and they do not have any
interpretation as mathematical objects. Each tool using it can interpet however
it wants although there is an underlying assumption that all tools will
interpret the language constructs in the same way.




%\section{Conclusion}
%add some conclusion thing that summarises this chapter and gives a pass to the
%next one

